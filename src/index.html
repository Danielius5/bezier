<!DOCTYPE html>
<html>
<head>
    <title>Bezier Curves</title>
    <style>
        html, body {
            height:100%;
            padding:0;
            margin:0;
            overflow:hidden
        }
        #wrapper {
            width: 100%;
            height:100%;          
        }
        /* #canvas {
            width: 100%;
            height:100%;
        } */
    </style>
</head>
<body>    
    <div id="wrapper">
        <button onclick="handleButtonClick(event)">Draw Bezier</button>
        <canvas id="canvas" onclick="handleOnCanvasClick(event)">
        Your browser does not support the canvas tag.
        </canvas>
    </div>
    <script>
        const c = document.getElementById("canvas");
        const canvasWrapperRect = document.getElementById('wrapper').getBoundingClientRect();
        const ctx = c.getContext("2d");
        c.height  = canvasWrapperRect.height;
        c.width  = canvasWrapperRect.width;

        ctx.strokeStyle = "#000000";
        ctx.fillStyle = "#000000";

        let supportPointsPositions = [];

        function drawFromPoints(points, thickness = 1, color = "#000") {
            for(const point of points) {
                drawCircle(ctx, point.x, point.y, thickness, color);
            }
        }

        function drawCircle(ctx, x, y, radius, fill, stroke, strokeWidth) {
            ctx.beginPath()
            ctx.arc(x, y, radius, 0, 2 * Math.PI, false)
            if (fill) {
                ctx.fillStyle = fill
                ctx.fill()
            }
            if (stroke) {
                ctx.lineWidth = strokeWidth
                ctx.strokeStyle = stroke
                ctx.stroke()
            }
        }

        function handleOnCanvasClick(e) {
            const newP = {x : e.x, y : e.y};
            try{
                const prevP = supportPointsPositions.at(-1);
                drawBezierFromSupportPoints([newP, prevP], 0.5, "#a00");
                // redraw so line is not on top of point
                drawCircle(ctx, prevP.x, prevP.y, 10, "#000000")

            } catch {}
            drawCircle(ctx, e.x, e.y, 10, "#000000")
            supportPointsPositions.push(newP)
        }

        function getBinomialCoefs(n) {
            if (n == 2) {
                return [1, 1]
            }
            const prev = getBinomialCoefs(n - 1);

            let nex = [1];
            for (let i = 1; i < n - 1; i++) {
                nex.push(prev[i - 1] + prev[i]);
            }
            nex.push(1);

            return nex;

        }

        function drawBezierFromSupportPoints(supportPoints, thickness = 2, color="#000") {
            if (supportPoints.length == 0) {
                return;
            }

            // increment of t = 1 / biggest difference between basier curve points components (x, y)
            let diff = 0;
            for(let i = 1; i < supportPoints.length; i++) {
                diff = Math.max(
                    diff, 
                    Math.abs(supportPoints[i - 1].x - supportPoints[i].x),
                    Math.abs(supportPoints[i - 1].y - supportPoints[i].y),
                );
            }

            let incr = 1 / diff / supportPoints.length;


            let coefs = getBinomialCoefs(supportPoints.length)

            let points = [];


            for(let t = 0; t <= 1; t += incr) {
                let nextX = 0;
                let nextY = 0;

                for(const [k, p] of Object.entries(supportPoints)) {
                    const mult = coefs[k] * Math.pow((1 - t), supportPoints.length - 1 - k) * Math.pow(t, k);

                    nextX += mult * p.x;
                    nextY += mult * p.y;
                }

                points.push({x : nextX, y: nextY});
            }
            drawFromPoints(points, thickness, color);
        }

        function handleButtonClick(event) {
            drawBezierFromSupportPoints(supportPointsPositions);
        }

    </script>
    
</body>
</html>